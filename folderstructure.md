# SPACE – Repository Folder Hierarchy & Structure Guide

*Purpose: Single‑source reference for where every file type lives and why*

---

## 0. Top‑Level Layout (root)

```
space/                       # Git repo root
├ apps/                      # Runtime artefacts (built bundles, admin_ui)
├ docs/                      # All human‑readable documentation
├ infra/                     # Infrastructure‑as‑Code (Terraform + Helm)
├ libs/                      # Reusable Python & TS packages
├ schema/                    # Avro / JSONSchema event contracts
├ services/                  # Containerised micro‑services
├ tests/                     # Automated tests (unit, e2e, chaos)
├ web/                       # Lovable‑exported public Next.js site (read‑only)
├ .github/                   # GitHub Actions
├ docker-compose.yml         # Local dev stack
├ .cursor-rules              # Cursor constraints
└ README.md
```

> **Golden rule:** No folder outside this whitelist may be added without Tech‑Lead sign‑off.

---

## 1. Folder Purpose & Ownership

| Folder        | Owning Squad | Contents                                                                                                     | Notes |
| ------------- | ------------ | ------------------------------------------------------------------------------------------------------------ | ----- |
| **apps/**     | Ops          | Built artefacts only (e.g. admin\_ui `dist/`). Generated by CI; ignored by Cursor.                           |       |
| **docs/**     | All          | ADRs, runbooks, prompts, ISO evidence, diagrams. Markdown preferred.                                         |       |
| **infra/**    | SRE          | `tf/` Terraform root‑modules; `helm/` service charts & Grafana dashboards. No app code.                      |       |
| **libs/**     | Platform     | Shared code lib. Sub‑folder per language (`py_common`, `ts_common`, `analytics`). Versioned via SemVer tags. |       |
| **schema/**   | Platform     | Canonical event schemas (`offer_created.avsc`, etc.). Subject to schema‑registry CI.                         |       |
| **services/** | Core         | One folder per micro‑service (see §2). Only runtime code + Dockerfile.                                       |       |
| **tests/**    | QA           | Mirrors libs/ & services/ for unit + e2e. Chaos and perf tests get their own sub‑dirs.                       |       |
| **web/**      | Growth       | Public UI from Lovable—Cursor has read‑only permission (enforced via `.cursor-rules`).                       |       |

---

## 2. Service Folder Template

```
services/<service_name>/
 ├ main.py            # FastAPI entry (or worker bootstrap)
 ├ routes.py          # HTTP routes (if applicable)
 ├ models.py          # SQLModel & Pydantic
 ├ tasks.py           # Celery tasks (optional)
 ├ requirements.txt   # runtime deps only (no dev)
 └ Dockerfile         # multi‑stage, python:3.12‑slim final
```

*Flat—no nested `src/`, `app/`, `package/` dirs.*

---

## 3. Libs Folder Template

```
libs/py_common/
 ├ __init__.py
 ├ config.py      # Pydantic‑based settings loader
 ├ flags.py       # LaunchDarkly helper
 └ logging.py     # structlog setup

libs/analytics/
 ├ __init__.py
 ├ feature_pipeline.py
 └ model_loader.py

libs/ts_common/  (generated via Turbo/Nx later)
```

---

## 4. Tests Layout

```
tests/
 ├ api/            # FastAPI endpoint tests
 ├ valuation/      # Model & feature tests
 ├ e2e/            # Playwright specs
 ├ chaos/          # Litmus manifests + asserts
 └ perf/           # k6 scripts + budgets
```

---

## 5. Naming & File Extensions

* Python files: `snake_case.py`
* TypeScript files: `camelCase.ts` inside `web/` or `admin_ui/` only
* Schemas: `.avsc` (Avro), `.schema.json` (JSONSchema)
* Terraform: `.tf`, `.tfvars`
* Helm templates: `.yaml` / `.tpl`
* Docs: `.md`

---

## 6. Cursor Enforcement Highlights

* `.cursor.json → ignoredFolders` includes `web/` and `apps/`.
* `maxFolders=7` prevents sprawl.
* Any PR introducing new top‑folder fails CI via `folder_guard.py` GitHub Action.

---

## 7. Local Dev Story

1. `just dev-up` → docker‑compose spins PG, Redis, MinIO.
2. Services run with `uvicorn --reload`.
3. `tilt up` for k3d local k8s if needed.
4. Public UI served via `pnpm run dev` inside `web/`.

---

## 8. FAQ

* **Q:** Varför skilja `apps/` och `services/`?
  **A:** `apps/` är bygg‑artefakter (e.g. compiled static admin\_ui) som aldrig tolkas av Python runtime.
* **Q:** Får vi lägga helper‑scripts i `scripts/`?
  **A:** Nej—använd `make` eller `just` targets i repo‑roten eller placera script i `infra/` om det är IaC.

---

**Document Version 1.0 • Maintainer: Platform Guild**
